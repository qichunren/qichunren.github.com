<html>
  <head>
    <meta content='Work with binary data - 蕲春人的博客' property='og:title' />
    <title>Work with binary data - 蕲春人的博客</title>
    <link href='/images/fav.png' rel='shortcut icon'>
<link href='/stylesheets/style.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/syntax.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/responsive.css' rel='stylesheet' type='text/css' />
<!-- - -->
<script src='/javascripts/jquery.js' type='text/javascript'></script>
<script src='/javascripts/pd.js' type='text/javascript'></script>
<script src='/javascripts/basics.js' type='text/javascript'></script>
<!--<script type="text/javascript" src="https://www.google.com/jsapi"></script>-->
<!-- - -->
<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />
<meta content="http://muan.co/images/og.png" property="og:image" />
<meta content="" property="fb:app_id" />

  <meta content='/development/2016/06/22/work-with-binary-data/' property='og:url' />
  <meta content="最近在做一些网络编程方面的东西，之前大多数情况接触的都是文本协议，现在接触的是二进制协议。在此补一下相关知识，下面基本上是以Ruby语言来描述用法。在Ruby中字面常量二近制数据以0b开头。qichunren@qichunren-wo..." property='og:description' />
  <meta content="article" property="og:type" />

<!-- - -->
<script type='text/javascript'>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6344646-4']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  //]]>
</script>

  </head>
  <body>
    <header>
<p>蕲春人的博客</p>
</header>
    <div id='container'>
      <div class="block">
  
    <a target="_top" class="main" href="/about">About</a>
  
    <a target="_top" class="main" href="http://qichunren.github.io">Blog</a>
  
    <a target="_blank" class="main" href="mailto:whyruby@gmail.com">Email</a>
  
    <a target="_top" class="main" href="https://github.com/qichunren">GitHub</a>
  
</div>
      <section class="paging">
  
    <div class="left">
      <a href="/development/2016/06/21/use-buildroot-cross-build-app/">
        ‹
      </a>
    </div>
  
  
    <div class="right">
      <a href="/development/2016/08/15/get-started-with-autotools/">
        ›
      </a>
    </div>
  
</section>
      <div class="content">
        <section class='post'>
          <h1 class="upcase">
            <div class='date'>22 Jun 2016</div>
            Work with binary data
          </h1>
          <p>最近在做一些网络编程方面的东西，之前大多数情况接触的都是文本协议，现在接触的是二进制协议。在此补一下相关知识，下面基本上是以Ruby语言来描述用法。</p>

<p>在Ruby中字面常量二近制数据以0b开头。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>qichunren@qichunren-work:~$ irb
1.9.3-p194 :001 &gt; 0b1010
 =&gt; 10 
1.9.3-p194 :002 &gt; 0b10
 =&gt; 2 
1.9.3-p194 :003 &gt; 0b11
 =&gt; 3 
1.9.3-p194 :004 &gt; 0b100
 =&gt; 4
</code></pre>
</div>

<h3 id="fixnumtosbase--10">Fixnum#to_s(base = 10)</h3>

<p>Fixnum#to_s(base = 10) 方法用于各种进制之间的转换。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>### 二进制转换成十进制

qichunren@qichunren-work:~$ irb
1.9.3-p194 :001 &gt; 0b10.to_s(10)
 =&gt; "2" 
1.9.3-p194 :002 &gt; 0b11.to_s(10)
 =&gt; "3" 
1.9.3-p194 :003 &gt; 0b100.to_s(10)
 =&gt; "4"
 
 
### 十进制转换成二进制

qichunren@qichunren-work:~$ irb
1.9.3-p194 :001 &gt; 10.to_s(2)
 =&gt; "1010" 
1.9.3-p194 :002 &gt; 4.to_s(2)
 =&gt; "100" 
1.9.3-p194 :003 &gt; 2.to_s(2)
 =&gt; "10"

### 十六进制转换成十进制

1.9.3-p194 :004 &gt; 0xFF.to_s(10)
 =&gt; "255" 
1.9.3-p194 :005 &gt; 0xFF.to_s
 =&gt; "255" 

### 十六进制转换成二进制

1.9.3-p194 :006 &gt; 0xFF.to_s(2)
 =&gt; "11111111"
</code></pre>
</div>

<h3 id="stringtoibase--10">String#to_i(base = 10)</h3>

<p>String#to_i(base = 10) 方法用于将各种进制的字符串转换成十进制数。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>qichunren@qichunren-work:~$ irb
1.9.3-p194 :001 &gt; "0b100".to_i(2)
 =&gt; 4 
1.9.3-p194 :002 &gt; "0100".to_i(10)
 =&gt; 100 
1.9.3-p194 :003 &gt; "0xFF".to_i(16)
 =&gt; 255   
</code></pre>
</div>

<p>注意：String#to_i方法的参数一定要和字符串本身的进制一致，否则将得不到预期的结果。</p>

<h3 id="packing-and-unpacking">Packing and unpacking</h3>

<p>String#unpack 和 Array#pack在网络程序中处理二进制时用得比较多。</p>

<div class="highlighter-rouge"><pre class="highlight"><code> qichunren@qichunren-work:~$ irb
 1.9.3-p194 :045 &gt; "\xff\x00\x2a".unpack('C*')
  =&gt; [255, 0, 42]
 1.9.3-p194 :042 &gt; [192,168,1,1].pack('C*')
  =&gt; "\xC0\xA8\x01\x01" 
 1.9.3-p194 :043 &gt; [255,255,255,255].pack('C*')
  =&gt; "\xFF\xFF\xFF\xFF"
</code></pre>
</div>

<p>下面是一个UDP广播二进制数据的例子</p>

<div class="highlighter-rouge"><pre class="highlight"><code>require 'socket'

udp_socket = UDPSocket.new 
udp_socket.bind("0.0.0.0", 8086)
udp_socket.setsockopt(Socket::SOL_SOCKET, Socket::SO_BROADCAST, true) 
100.times do |i| 
    puts "Broadcast message ..."
    udp_socket.send([0x01, 0x10, 0x00, 0x03, 0x00, 0x04, 0x00, 0x00, 0x96, 0x96, 0xc1, 0x0c].pack('C*'), 0, "255.255.255.255", 1112) 
    sleep 3
end     
</code></pre>
</div>

<h3 id="section">位操作</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>&amp; bitwise AND
| bitwise OR
^ bitwise XOR
~ bitwise NOT
&gt;&gt; right shift
&lt;&lt; left shift         
</code></pre>
</div>

<h4 id="resources">Resources</h4>

<ul>
  <li><a href="http://blog.bigbinary.com/2011/07/20/ruby-pack-unpack.html">Ruby pack unpack</a></li>
  <li><a href="https://calleerlandsson.com/2014/02/06/rubys-bitwise-operators/">Ruby’s bitwise operators</a></li>
</ul>

          <br />
<p>
  蕲春人
  <span class="muted">at 11:25</span>
</p>
<p>
  <img src="/images/scribble3.png" alt="scribble" />
</p>


        </section>
      </div>
      

      
      <div class="block">
  
    <a target="_top" class="main" href="/about">About</a>
  
    <a target="_top" class="main" href="http://qichunren.github.io">Blog</a>
  
    <a target="_blank" class="main" href="mailto:whyruby@gmail.com">Email</a>
  
    <a target="_top" class="main" href="https://github.com/qichunren">GitHub</a>
  
</div>
    </div>
    <footer>
  <a href="http://github.com/muan/scribble" class="muted">built with Jekyll using Scribble theme</a>
</footer>
  </body>
</html>
